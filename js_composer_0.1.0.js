define("JSComposer/Utils",[],function(){function t(){var e=arguments.length;for(var t=0;t<e;++t)if(arguments[t]!==undefined)return arguments[t];return undefined}function n(e,t){for(var n=0;n<t.length;++n)if(e(t[n]))return!0;return!1}function r(e,t){var n=0;for(var r=0;r<t.length;++r)n.push(e(t[r]));return n}function i(e,t){var n=document.createElement(e);return f(n,t),n}function s(e,n,r){r=t(r,{}),n=t(n,!0);var s=i("select",r);return o(s,n,e),s}function o(e,t,n){var r=e.getElementsByTagName("option"),s=undefined,o=undefined,u=undefined,a=0,f=r.length;f==0&&t&&e.add(i("option",{text:"Select one...",value:null})),typeof n=="object"&&n.length!==undefined?(s=function(){for(var t=0,r=n.length;t<r;++t){var s=n[t],o=i("option",{text:s,value:s});e.add(o)}},o=function(e){return n.indexOf(e)>=0},u=function(e){var t=n.indexOf(e);n.splice(t,1)}):(s=function(){for(var t in n){if(!n.hasOwnProperty(t))continue;var r=i("option",{text:n[t],value:t});e.add(r)}},o=function(e){return n.hasOwnProperty(e)},u=function(e){delete n[e]});for(a=0;a<r.length;++a){var l=r[a].value;if(t&&l===null)continue;o(l)?u(l):(e.removeChild(r[a]),a--)}s()}function u(e,t){var n=0,r=e.length;for(n=0;n<r;++n)if(e.options[n].value===t){e.selectedIndex=n;break}}function a(e,t){var n=e.selectedIndex;return n===-1?undefined:e.options[n].value}function f(e,n){n=t(n,{});for(var r in n)typeof n[r]=="object"&&n[r]!==null&&n[r].length===undefined?f(e[r],n[r]):e[r]=n[r];return e}function l(e,t){var n=e.className.split(/\s+/);n.push(t),e.className=n.join(" ")}function c(e,t){var n=e.className.split(/\s+/);for(var r=n.indexOf(t);r>=0;r=n.indexOf(t))n.splice(r,1);e.className=n.join(" ")}function h(e){var t=[];for(var n in e)t.push(n);return t}function p(e){var t=h(e),n={};for(var r=0,i=t.length;r<i;++r){var s=t[r],o=e[s],u=o.title;n[s]=typeof u=="undefined"?s:u}return n}function d(e,t){e.textContent=t}function v(e,t){e.innerText=t}function m(e){return e.textContent}function g(e){return e.innerText}function y(e,t,n){e.addEventListener(t,n,!1)}function b(e,t,n){e.attachEvent("on"+t,n)}function x(e,t){return function(){typeof e=="function"&&e.apply(this,arguments),t.apply(this,arguments)}}function T(e){var t=undefined;switch(typeof e){case"object":if(e===null)return e;if(typeof e.length!="undefined"){t=[];for(var n=0,r=e.length;n<r;++n)t.push(T(e[n]))}else{t={};for(var i in e)t[i]=T(e[i])}break;default:t=e}return t}var e={},w=function(t,n){if(t.textContent!==undefined)e.setText=d;else{if(t.innerText===undefined)throw{error:"badarg",offender:t};e.setText=v}e.setText(t,n)},E=function(t){if(t.textContent!==undefined)e.getText=m;else{if(t.innerText===undefined)throw{error:"badarg",offender:t};e.getText=g}e.getText(t)},S=function(t,n,r){if(t.attachEvent!==undefined)e.attachEvent=b;else{if(t.addEventListener===undefined)throw{error:"badarg",offender:t};e.attachEvent=y}e.attachEvent(t,n,r)};return e={makeElement:i,makeSelect:s,setSelectOptions:o,setSelectValue:u,getSelectValue:a,applyClass:l,removeClass:c,any:n,map:r,ldef:t,setText:w,getText:E,attachEvent:S,getKeys:h,getTitles:p,appendFunction:x,clone:T},e}),function(e,t){typeof define=="function"&&define.amd?define("tv4",[],t):typeof module!="undefined"&&module.exports?module.exports=t():e.tv4=t()}(this,function(){function n(e){return encodeURI(e).replace(/%25[0-9][0-9]/g,function(e){return"%"+e.substring(3)})}function r(r){var i="";e[r.charAt(0)]&&(i=r.charAt(0),r=r.substring(1));var s="",o="",u=!0,a=!1,f=!1;i==="+"?u=!1:i==="."?(o=".",s="."):i==="/"?(o="/",s="/"):i==="#"?(o="#",u=!1):i===";"?(o=";",s=";",a=!0,f=!0):i==="?"?(o="?",s="&",a=!0):i==="&"&&(o="&",s="&",a=!0);var l=[],c=r.split(","),h=[],p={};for(var d=0;d<c.length;d++){var v=c[d],m=null;if(v.indexOf(":")!==-1){var g=v.split(":");v=g[0],m=parseInt(g[1],10)}var y={};while(t[v.charAt(v.length-1)])y[v.charAt(v.length-1)]=!0,v=v.substring(0,v.length-1);var b={truncate:m,name:v,suffices:y};h.push(b),p[v]=b,l.push(v)}var w=function(e){var t="",r=0;for(var i=0;i<h.length;i++){var l=h[i],c=e(l.name);if(c===null||c===undefined||Array.isArray(c)&&c.length===0||typeof c=="object"&&Object.keys(c).length===0){r++;continue}i===r?t+=o:t+=s||",";if(Array.isArray(c)){a&&(t+=l.name+"=");for(var p=0;p<c.length;p++)p>0&&(t+=l.suffices["*"]?s||",":",",l.suffices["*"]&&a&&(t+=l.name+"=")),t+=u?encodeURIComponent(c[p]).replace(/!/g,"%21"):n(c[p])}else if(typeof c=="object"){a&&!l.suffices["*"]&&(t+=l.name+"=");var d=!0;for(var v in c)d||(t+=l.suffices["*"]?s||",":","),d=!1,t+=u?encodeURIComponent(v).replace(/!/g,"%21"):n(v),t+=l.suffices["*"]?"=":",",t+=u?encodeURIComponent(c[v]).replace(/!/g,"%21"):n(c[v])}else{if(a){t+=l.name;if(!f||c!=="")t+="="}l.truncate!=null&&(c=c.substring(0,l.truncate)),t+=u?encodeURIComponent(c).replace(/!/g,"%21"):n(c)}}return t};return w.varNames=l,{prefix:o,substitution:w}}function i(e){if(!(this instanceof i))return new i(e);var t=e.split("{"),n=[t.shift()],s=[],o=[],u=[];while(t.length>0){var a=t.shift(),f=a.split("}")[0],l=a.substring(f.length+1),c=r(f);o.push(c.substitution),s.push(c.prefix),n.push(l),u=u.concat(c.substitution.varNames)}this.fill=function(e){var t=n[0];for(var r=0;r<o.length;r++){var i=o[r];t+=i(e),t+=n[r+1]}return t},this.varNames=u,this.template=e}function o(e,t){if(e===t)return!0;if(typeof e=="object"&&typeof t=="object"){if(Array.isArray(e)!==Array.isArray(t))return!1;if(Array.isArray(e)){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!o(e[n],t[n]))return!1}else{var r;for(r in e)if(t[r]===undefined&&e[r]!==undefined)return!1;for(r in t)if(e[r]===undefined&&t[r]!==undefined)return!1;for(r in e)if(!o(e[r],t[r]))return!1}return!0}return!1}function f(e){var t=String(e).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return t?{href:t[0]||"",protocol:t[1]||"",authority:t[2]||"",host:t[3]||"",hostname:t[4]||"",port:t[5]||"",pathname:t[6]||"",search:t[7]||"",hash:t[8]||""}:null}function l(e,t){function n(e){var t=[];return e.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(e){e==="/.."?t.pop():t.push(e)}),t.join("").replace(/^\//,e.charAt(0)==="/"?"/":"")}return t=f(t||""),e=f(e||""),!t||!e?null:(t.protocol||e.protocol)+(t.protocol||t.authority?t.authority:e.authority)+n(t.protocol||t.authority||t.pathname.charAt(0)==="/"?t.pathname:t.pathname?(e.authority&&!e.pathname?"/":"")+e.pathname.slice(0,e.pathname.lastIndexOf("/")+1)+t.pathname:e.pathname)+(t.protocol||t.authority||t.pathname?t.search:t.search||e.search)+t.hash}function c(e){return e.split("#")[0]}function h(e,t){if(e&&typeof e=="object"){t===undefined?t=e.id:typeof e.id=="string"&&(t=l(t,e.id),e.id=t);if(Array.isArray(e))for(var n=0;n<e.length;n++)h(e[n],t);else{typeof e["$ref"]=="string"&&(e.$ref=l(t,e.$ref));for(var r in e)r!=="enum"&&h(e[r],t)}}}function g(e,t,n,r,i,s){Error.call(this);if(e===undefined)throw new Error("No code supplied for error: "+t);this.message=t,this.params=n,this.code=e,this.dataPath=r||"",this.schemaPath=i||"",this.subErrors=s||null;var o=new Error(this.message);this.stack=o.stack||o.stacktrace;if(!this.stack)try{throw o}catch(o){this.stack=o.stack||o.stacktrace}}function y(e,t){if(t.substring(0,e.length)===e){var n=t.substring(e.length);if(t.length>0&&t.charAt(e.length-1)==="/"||n.charAt(0)==="#"||n.charAt(0)==="?")return!0}return!1}function w(e){var t=new s,n=e||"en",r={addFormat:function(){t.addFormat.apply(t,arguments)},language:function(e){return e?(b[e]||(e=e.split("-")[0]),b[e]?(n=e,e):!1):n},addLanguage:function(e,t){var n;for(n in p)t[n]&&!t[p[n]]&&(t[p[n]]=t[n]);var r=e.split("-")[0];if(!b[r])b[e]=t,b[r]=t;else{b[e]=Object.create(b[r]);for(n in t)typeof b[r][n]=="undefined"&&(b[r][n]=t[n]),b[e][n]=t[n]}return this},freshApi:function(e){var t=w();return e&&t.language(e),t},validate:function(e,r,i,o){var u=new s(t,!1,b[n],i,o);typeof r=="string"&&(r={$ref:r}),u.addSchema("",r);var a=u.validateAll(e,r,null,null,"");return!a&&o&&(a=u.banUnknownProperties()),this.error=a,this.missing=u.missing,this.valid=a===null,this.valid},validateResult:function(){var e={};return this.validate.apply(e,arguments),e},validateMultiple:function(e,r,i,o){var u=new s(t,!0,b[n],i,o);typeof r=="string"&&(r={$ref:r}),u.addSchema("",r),u.validateAll(e,r,null,null,""),o&&u.banUnknownProperties();var a={};return a.errors=u.errors,a.missing=u.missing,a.valid=a.errors.length===0,a},addSchema:function(){return t.addSchema.apply(t,arguments)},getSchema:function(){return t.getSchema.apply(t,arguments)},getSchemaMap:function(){return t.getSchemaMap.apply(t,arguments)},getSchemaUris:function(){return t.getSchemaUris.apply(t,arguments)},getMissingUris:function(){return t.getMissingUris.apply(t,arguments)},dropSchemas:function(){t.dropSchemas.apply(t,arguments)},defineKeyword:function(){t.defineKeyword.apply(t,arguments)},defineError:function(e,t,n){if(typeof e!="string"||!/^[A-Z]+(_[A-Z]+)*$/.test(e))throw new Error("Code name must be a string in UPPER_CASE_WITH_UNDERSCORES");if(typeof t!="number"||t%1!==0||t<1e4)throw new Error("Code number must be an integer > 10000");if(typeof p[e]!="undefined")throw new Error("Error already defined: "+e+" as "+p[e]);if(typeof d[t]!="undefined")throw new Error("Error code already used: "+d[t]+" as "+t);p[e]=t,d[t]=e,m[e]=m[t]=n;for(var r in b){var i=b[r];i[e]&&(i[t]=i[t]||i[e])}},reset:function(){t.reset(),this.error=null,this.missing=[],this.valid=!0},missing:[],error:null,valid:!0,normSchema:h,resolveUrl:l,getDocumentUri:c,errorCodes:p};return r}Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=n.length;return function(i){if(typeof i!="object"&&typeof i!="function"||i===null)throw new TypeError("Object.keys called on non-object");var s=[];for(var o in i)e.call(i,o)&&s.push(o);if(t)for(var u=0;u<r;u++)e.call(i,n[u])&&s.push(n[u]);return s}}()),Object.create||(Object.create=function(){function e(){}return function(t){if(arguments.length!==1)throw new Error("Object.create implementation only accepts one parameter.");return e.prototype=t,new e}}()),Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(this===null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>1&&(r=Number(arguments[1]),r!==r?r=0:r!==0&&r!==Infinity&&r!==-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1}),Object.isFrozen||(Object.isFrozen=function(e){var t="tv4_test_frozen_key";while(e.hasOwnProperty(t))t+=Math.random();try{return e[t]=!0,delete e[t],!1}catch(n){return!0}});var e={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},t={"*":!0};i.prototype={toString:function(){return this.template},fillFromObject:function(e){return this.fill(function(t){return e[t]})}};var s=function(t,n,r,i,s){this.missing=[],this.missingMap={},this.formatValidators=t?Object.create(t.formatValidators):{},this.schemas=t?Object.create(t.schemas):{},this.collectMultiple=n,this.errors=[],this.handleError=n?this.collectError:this.returnError,i&&(this.checkRecursive=!0,this.scanned=[],this.scannedFrozen=[],this.scannedFrozenSchemas=[],this.scannedFrozenValidationErrors=[],this.validatedSchemasKey="tv4_validation_id",this.validationErrorsKey="tv4_validation_errors_id"),s&&(this.trackUnknownProperties=!0,this.knownPropertyPaths={},this.unknownPropertyPaths={}),this.errorMessages=r,this.definedKeywords={};if(t)for(var o in t.definedKeywords)this.definedKeywords[o]=t.definedKeywords[o].slice(0)};s.prototype.defineKeyword=function(e,t){this.definedKeywords[e]=this.definedKeywords[e]||[],this.definedKeywords[e].push(t)},s.prototype.createError=function(e,t,n,r,i){var s=this.errorMessages[e]||m[e];if(typeof s!="string")return new g(e,"Unknown error code "+e+": "+JSON.stringify(t),t,n,r,i);var o=s.replace(/\{([^{}]*)\}/g,function(e,n){var r=t[n];return typeof r=="string"||typeof r=="number"?r:e});return new g(e,o,t,n,r,i)},s.prototype.returnError=function(e){return e},s.prototype.collectError=function(e){return e&&this.errors.push(e),null},s.prototype.prefixErrors=function(e,t,n){for(var r=e;r<this.errors.length;r++)this.errors[r]=this.errors[r].prefixWith(t,n);return this},s.prototype.banUnknownProperties=function(){for(var e in this.unknownPropertyPaths){var t=this.createError(p.UNKNOWN_PROPERTY,{path:e},e,""),n=this.handleError(t);if(n)return n}return null},s.prototype.addFormat=function(e,t){if(typeof e=="object"){for(var n in e)this.addFormat(n,e[n]);return this}this.formatValidators[e]=t},s.prototype.resolveRefs=function(e,t){if(e.$ref!==undefined){t=t||{};if(t[e.$ref])return this.createError(p.CIRCULAR_REFERENCE,{urls:Object.keys(t).join(", ")},"","");t[e.$ref]=!0,e=this.getSchema(e.$ref,t)}return e},s.prototype.getSchema=function(e,t){var n;if(this.schemas[e]!==undefined)return n=this.schemas[e],this.resolveRefs(n,t);var r=e,i="";e.indexOf("#")!==-1&&(i=e.substring(e.indexOf("#")+1),r=e.substring(0,e.indexOf("#")));if(typeof this.schemas[r]=="object"){n=this.schemas[r];var s=decodeURIComponent(i);if(s==="")return this.resolveRefs(n,t);if(s.charAt(0)!=="/")return undefined;var o=s.split("/").slice(1);for(var u=0;u<o.length;u++){var a=o[u].replace(/~1/g,"/").replace(/~0/g,"~");if(n[a]===undefined){n=undefined;break}n=n[a]}if(n!==undefined)return this.resolveRefs(n,t)}this.missing[r]===undefined&&(this.missing.push(r),this.missing[r]=r,this.missingMap[r]=r)},s.prototype.searchSchemas=function(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)this.searchSchemas(e[n],t);else if(e&&typeof e=="object"){typeof e.id=="string"&&y(t,e.id)&&this.schemas[e.id]===undefined&&(this.schemas[e.id]=e);for(var r in e)if(r!=="enum")if(typeof e[r]=="object")this.searchSchemas(e[r],t);else if(r==="$ref"){var i=c(e[r]);i&&this.schemas[i]===undefined&&this.missingMap[i]===undefined&&(this.missingMap[i]=i)}}},s.prototype.addSchema=function(e,t){if(typeof e!="string"||typeof t=="undefined"){if(typeof e!="object"||typeof e.id!="string")return;t=e,e=t.id}e===c(e)+"#"&&(e=c(e)),this.schemas[e]=t,delete this.missingMap[e],h(t,e),this.searchSchemas(t,e)},s.prototype.getSchemaMap=function(){var e={};for(var t in this.schemas)e[t]=this.schemas[t];return e},s.prototype.getSchemaUris=function(e){var t=[];for(var n in this.schemas)(!e||e.test(n))&&t.push(n);return t},s.prototype.getMissingUris=function(e){var t=[];for(var n in this.missingMap)(!e||e.test(n))&&t.push(n);return t},s.prototype.dropSchemas=function(){this.schemas={},this.reset()},s.prototype.reset=function(){this.missing=[],this.missingMap={},this.errors=[]},s.prototype.validateAll=function(e,t,n,r,i){var s;t=this.resolveRefs(t);if(!t)return null;if(t instanceof g)return this.errors.push(t),t;var o=this.errors.length,u,a=null,f=null;if(this.checkRecursive&&e&&typeof e=="object"){s=!this.scanned.length;if(e[this.validatedSchemasKey]){var l=e[this.validatedSchemasKey].indexOf(t);if(l!==-1)return this.errors=this.errors.concat(e[this.validationErrorsKey][l]),null}if(Object.isFrozen(e)){u=this.scannedFrozen.indexOf(e);if(u!==-1){var c=this.scannedFrozenSchemas[u].indexOf(t);if(c!==-1)return this.errors=this.errors.concat(this.scannedFrozenValidationErrors[u][c]),null}}this.scanned.push(e);if(Object.isFrozen(e))u===-1&&(u=this.scannedFrozen.length,this.scannedFrozen.push(e),this.scannedFrozenSchemas.push([])),a=this.scannedFrozenSchemas[u].length,this.scannedFrozenSchemas[u][a]=t,this.scannedFrozenValidationErrors[u][a]=[];else{if(!e[this.validatedSchemasKey])try{Object.defineProperty(e,this.validatedSchemasKey,{value:[],configurable:!0}),Object.defineProperty(e,this.validationErrorsKey,{value:[],configurable:!0})}catch(h){e[this.validatedSchemasKey]=[],e[this.validationErrorsKey]=[]}f=e[this.validatedSchemasKey].length,e[this.validatedSchemasKey][f]=t,e[this.validationErrorsKey][f]=[]}}var p=this.errors.length,d=this.validateBasic(e,t,i)||this.validateNumeric(e,t,i)||this.validateString(e,t,i)||this.validateArray(e,t,i)||this.validateObject(e,t,i)||this.validateCombinations(e,t,i)||this.validateHypermedia(e,t,i)||this.validateFormat(e,t,i)||this.validateDefinedKeywords(e,t,i)||null;if(s){while(this.scanned.length){var v=this.scanned.pop();delete v[this.validatedSchemasKey]}this.scannedFrozen=[],this.scannedFrozenSchemas=[]}if(d||p!==this.errors.length)while(n&&n.length||r&&r.length){var m=n&&n.length?""+n.pop():null,y=r&&r.length?""+r.pop():null;d&&(d=d.prefixWith(m,y)),this.prefixErrors(p,m,y)}return a!==null?this.scannedFrozenValidationErrors[u][a]=this.errors.slice(o):f!==null&&(e[this.validationErrorsKey][f]=this.errors.slice(o)),this.handleError(d)},s.prototype.validateFormat=function(e,t){if(typeof t.format!="string"||!this.formatValidators[t.format])return null;var n=this.formatValidators[t.format].call(null,e,t);return typeof n=="string"||typeof n=="number"?this.createError(p.FORMAT_CUSTOM,{message:n}).prefixWith(null,"format"):n&&typeof n=="object"?this.createError(p.FORMAT_CUSTOM,{message:n.message||"?"},n.dataPath||null,n.schemaPath||"/format"):null},s.prototype.validateDefinedKeywords=function(e,t,n){for(var r in this.definedKeywords){if(typeof t[r]=="undefined")continue;var i=this.definedKeywords[r];for(var s=0;s<i.length;s++){var o=i[s],u=o(e,t[r],t,n);if(typeof u=="string"||typeof u=="number")return this.createError(p.KEYWORD_CUSTOM,{key:r,message:u}).prefixWith(null,"format");if(u&&typeof u=="object"){var a=u.code;if(typeof a=="string"){if(!p[a])throw new Error("Undefined error code (use defineError): "+a);a=p[a]}else typeof a!="number"&&(a=p.KEYWORD_CUSTOM);var f=typeof u.message=="object"?u.message:{key:r,message:u.message||"?"},l=u.schemaPath||"/"+r.replace(/~/g,"~0").replace(/\//g,"~1");return this.createError(a,f,u.dataPath||null,l)}}}return null},s.prototype.validateBasic=function(t,n,r){var i;return(i=this.validateType(t,n,r))?i.prefixWith(null,"type"):(i=this.validateEnum(t,n,r))?i.prefixWith(null,"type"):null},s.prototype.validateType=function(t,n){if(n.type===undefined)return null;var r=typeof t;t===null?r="null":Array.isArray(t)&&(r="array");var i=n.type;typeof i!="object"&&(i=[i]);for(var s=0;s<i.length;s++){var o=i[s];if(o===r||o==="integer"&&r==="number"&&t%1===0)return null}return this.createError(p.INVALID_TYPE,{type:r,expected:i.join("/")})},s.prototype.validateEnum=function(t,n){if(n["enum"]===undefined)return null;for(var r=0;r<n["enum"].length;r++){var i=n["enum"][r];if(o(t,i))return null}return this.createError(p.ENUM_MISMATCH,{value:typeof JSON!="undefined"?JSON.stringify(t):t})},s.prototype.validateNumeric=function(t,n,r){return this.validateMultipleOf(t,n,r)||this.validateMinMax(t,n,r)||this.validateNaN(t,n,r)||null};var u=Math.pow(2,-51),a=1-u;s.prototype.validateMultipleOf=function(t,n){var r=n.multipleOf||n.divisibleBy;if(r===undefined)return null;if(typeof t=="number"){var i=t/r%1;if(i>=u&&i<a)return this.createError(p.NUMBER_MULTIPLE_OF,{value:t,multipleOf:r})}return null},s.prototype.validateMinMax=function(t,n){if(typeof t!="number")return null;if(n.minimum!==undefined){if(t<n.minimum)return this.createError(p.NUMBER_MINIMUM,{value:t,minimum:n.minimum}).prefixWith(null,"minimum");if(n.exclusiveMinimum&&t===n.minimum)return this.createError(p.NUMBER_MINIMUM_EXCLUSIVE,{value:t,minimum:n.minimum}).prefixWith(null,"exclusiveMinimum")}if(n.maximum!==undefined){if(t>n.maximum)return this.createError(p.NUMBER_MAXIMUM,{value:t,maximum:n.maximum}).prefixWith(null,"maximum");if(n.exclusiveMaximum&&t===n.maximum)return this.createError(p.NUMBER_MAXIMUM_EXCLUSIVE,{value:t,maximum:n.maximum}).prefixWith(null,"exclusiveMaximum")}return null},s.prototype.validateNaN=function(t){return typeof t!="number"?null:isNaN(t)===!0||t===Infinity||t===-Infinity?this.createError(p.NUMBER_NOT_A_NUMBER,{value:t}).prefixWith(null,"type"):null},s.prototype.validateString=function(t,n,r){return this.validateStringLength(t,n,r)||this.validateStringPattern(t,n,r)||null},s.prototype.validateStringLength=function(t,n){return typeof t!="string"?null:n.minLength!==undefined&&t.length<n.minLength?this.createError(p.STRING_LENGTH_SHORT,{length:t.length,minimum:n.minLength}).prefixWith(null,"minLength"):n.maxLength!==undefined&&t.length>n.maxLength?this.createError(p.STRING_LENGTH_LONG,{length:t.length,maximum:n.maxLength}).prefixWith(null,"maxLength"):null},s.prototype.validateStringPattern=function(t,n){if(typeof t!="string"||n.pattern===undefined)return null;var r=new RegExp(n.pattern);return r.test(t)?null:this.createError(p.STRING_PATTERN,{pattern:n.pattern}).prefixWith(null,"pattern")},s.prototype.validateArray=function(t,n,r){return Array.isArray(t)?this.validateArrayLength(t,n,r)||this.validateArrayUniqueItems(t,n,r)||this.validateArrayItems(t,n,r)||null:null},s.prototype.validateArrayLength=function(t,n){var r;if(n.minItems!==undefined&&t.length<n.minItems){r=this.createError(p.ARRAY_LENGTH_SHORT,{length:t.length,minimum:n.minItems}).prefixWith(null,"minItems");if(this.handleError(r))return r}if(n.maxItems!==undefined&&t.length>n.maxItems){r=this.createError(p.ARRAY_LENGTH_LONG,{length:t.length,maximum:n.maxItems}).prefixWith(null,"maxItems");if(this.handleError(r))return r}return null},s.prototype.validateArrayUniqueItems=function(t,n){if(n.uniqueItems)for(var r=0;r<t.length;r++)for(var i=r+1;i<t.length;i++)if(o(t[r],t[i])){var s=this.createError(p.ARRAY_UNIQUE,{match1:r,match2:i}).prefixWith(null,"uniqueItems");if(this.handleError(s))return s}return null},s.prototype.validateArrayItems=function(t,n,r){if(n.items===undefined)return null;var i,s;if(Array.isArray(n.items)){for(s=0;s<t.length;s++)if(s<n.items.length){if(i=this.validateAll(t[s],n.items[s],[s],["items",s],r+"/"+s))return i}else if(n.additionalItems!==undefined)if(typeof n.additionalItems=="boolean"){if(!n.additionalItems){i=this.createError(p.ARRAY_ADDITIONAL_ITEMS,{}).prefixWith(""+s,"additionalItems");if(this.handleError(i))return i}}else if(i=this.validateAll(t[s],n.additionalItems,[s],["additionalItems"],r+"/"+s))return i}else for(s=0;s<t.length;s++)if(i=this.validateAll(t[s],n.items,[s],["items"],r+"/"+s))return i;return null},s.prototype.validateObject=function(t,n,r){return typeof t!="object"||t===null||Array.isArray(t)?null:this.validateObjectMinMaxProperties(t,n,r)||this.validateObjectRequiredProperties(t,n,r)||this.validateObjectProperties(t,n,r)||this.validateObjectDependencies(t,n,r)||null},s.prototype.validateObjectMinMaxProperties=function(t,n){var r=Object.keys(t),i;if(n.minProperties!==undefined&&r.length<n.minProperties){i=this.createError(p.OBJECT_PROPERTIES_MINIMUM,{propertyCount:r.length,minimum:n.minProperties}).prefixWith(null,"minProperties");if(this.handleError(i))return i}if(n.maxProperties!==undefined&&r.length>n.maxProperties){i=this.createError(p.OBJECT_PROPERTIES_MAXIMUM,{propertyCount:r.length,maximum:n.maxProperties}).prefixWith(null,"maxProperties");if(this.handleError(i))return i}return null},s.prototype.validateObjectRequiredProperties=function(t,n){if(n.required!==undefined)for(var r=0;r<n.required.length;r++){var i=n.required[r];if(t[i]===undefined){var s=this.createError(p.OBJECT_REQUIRED,{key:i}).prefixWith(null,""+r).prefixWith(null,"required");if(this.handleError(s))return s}}return null},s.prototype.validateObjectProperties=function(t,n,r){var i;for(var s in t){var o=r+"/"+s.replace(/~/g,"~0").replace(/\//g,"~1"),u=!1;if(n.properties!==undefined&&n.properties[s]!==undefined){u=!0;if(i=this.validateAll(t[s],n.properties[s],[s],["properties",s],o))return i}if(n.patternProperties!==undefined)for(var a in n.patternProperties){var f=new RegExp(a);if(f.test(s)){u=!0;if(i=this.validateAll(t[s],n.patternProperties[a],[s],["patternProperties",a],o))return i}}if(!u)if(n.additionalProperties!==undefined){this.trackUnknownProperties&&(this.knownPropertyPaths[o]=!0,delete this.unknownPropertyPaths[o]);if(typeof n.additionalProperties=="boolean"){if(!n.additionalProperties){i=this.createError(p.OBJECT_ADDITIONAL_PROPERTIES,{}).prefixWith(s,"additionalProperties");if(this.handleError(i))return i}}else if(i=this.validateAll(t[s],n.additionalProperties,[s],["additionalProperties"],o))return i}else this.trackUnknownProperties&&!this.knownPropertyPaths[o]&&(this.unknownPropertyPaths[o]=!0);else this.trackUnknownProperties&&(this.knownPropertyPaths[o]=!0,delete this.unknownPropertyPaths[o])}return null},s.prototype.validateObjectDependencies=function(t,n,r){var i;if(n.dependencies!==undefined)for(var s in n.dependencies)if(t[s]!==undefined){var o=n.dependencies[s];if(typeof o=="string"){if(t[o]===undefined){i=this.createError(p.OBJECT_DEPENDENCY_KEY,{key:s,missing:o}).prefixWith(null,s).prefixWith(null,"dependencies");if(this.handleError(i))return i}}else if(Array.isArray(o))for(var u=0;u<o.length;u++){var a=o[u];if(t[a]===undefined){i=this.createError(p.OBJECT_DEPENDENCY_KEY,{key:s,missing:a}).prefixWith(null,""+u).prefixWith(null,s).prefixWith(null,"dependencies");if(this.handleError(i))return i}}else if(i=this.validateAll(t,o,[],["dependencies",s],r))return i}return null},s.prototype.validateCombinations=function(t,n,r){return this.validateAllOf(t,n,r)||this.validateAnyOf(t,n,r)||this.validateOneOf(t,n,r)||this.validateNot(t,n,r)||null},s.prototype.validateAllOf=function(t,n,r){if(n.allOf===undefined)return null;var i;for(var s=0;s<n.allOf.length;s++){var o=n.allOf[s];if(i=this.validateAll(t,o,[],["allOf",s],r))return i}return null},s.prototype.validateAnyOf=function(t,n,r){if(n.anyOf===undefined)return null;var i=[],s=this.errors.length,o,u;this.trackUnknownProperties&&(o=this.unknownPropertyPaths,u=this.knownPropertyPaths);var a=!0;for(var f=0;f<n.anyOf.length;f++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var l=n.anyOf[f],c=this.errors.length,h=this.validateAll(t,l,[],["anyOf",f],r);if(h===null&&c===this.errors.length){this.errors=this.errors.slice(0,s);if(this.trackUnknownProperties){for(var d in this.knownPropertyPaths)u[d]=!0,delete o[d];for(var v in this.unknownPropertyPaths)u[v]||(o[v]=!0);a=!1;continue}return null}h&&i.push(h.prefixWith(null,""+f).prefixWith(null,"anyOf"))}this.trackUnknownProperties&&(this.unknownPropertyPaths=o,this.knownPropertyPaths=u);if(a)return i=i.concat(this.errors.slice(s)),this.errors=this.errors.slice(0,s),this.createError(p.ANY_OF_MISSING,{},"","/anyOf",i)},s.prototype.validateOneOf=function(t,n,r){if(n.oneOf===undefined)return null;var i=null,s=[],o=this.errors.length,u,a;this.trackUnknownProperties&&(u=this.unknownPropertyPaths,a=this.knownPropertyPaths);for(var f=0;f<n.oneOf.length;f++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var l=n.oneOf[f],c=this.errors.length,h=this.validateAll(t,l,[],["oneOf",f],r);if(h===null&&c===this.errors.length){if(i!==null)return this.errors=this.errors.slice(0,o),this.createError(p.ONE_OF_MULTIPLE,{index1:i,index2:f},"","/oneOf");i=f;if(this.trackUnknownProperties){for(var d in this.knownPropertyPaths)a[d]=!0,delete u[d];for(var v in this.unknownPropertyPaths)a[v]||(u[v]=!0)}}else h&&s.push(h)}return this.trackUnknownProperties&&(this.unknownPropertyPaths=u,this.knownPropertyPaths=a),i===null?(s=s.concat(this.errors.slice(o)),this.errors=this.errors.slice(0,o),this.createError(p.ONE_OF_MISSING,{},"","/oneOf",s)):(this.errors=this.errors.slice(0,o),null)},s.prototype.validateNot=function(t,n,r){if(n.not===undefined)return null;var i=this.errors.length,s,o;this.trackUnknownProperties&&(s=this.unknownPropertyPaths,o=this.knownPropertyPaths,this.unknownPropertyPaths={},this.knownPropertyPaths={});var u=this.validateAll(t,n.not,null,null,r),a=this.errors.slice(i);return this.errors=this.errors.slice(0,i),this.trackUnknownProperties&&(this.unknownPropertyPaths=s,this.knownPropertyPaths=o),u===null&&a.length===0?this.createError(p.NOT_PASSED,{},"","/not"):null},s.prototype.validateHypermedia=function(t,n,r){if(!n.links)return null;var s;for(var o=0;o<n.links.length;o++){var u=n.links[o];if(u.rel==="describedby"){var a=new i(u.href),f=!0;for(var l=0;l<a.varNames.length;l++)if(!(a.varNames[l]in t)){f=!1;break}if(f){var c=a.fillFromObject(t),h={$ref:c};if(s=this.validateAll(t,h,[],["links",o],r))return s}}}};var p={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,NUMBER_NOT_A_NUMBER:105,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403,FORMAT_CUSTOM:500,KEYWORD_CUSTOM:501,CIRCULAR_REFERENCE:600,UNKNOWN_PROPERTY:1e3},d={};for(var v in p)d[p[v]]=v;var m={INVALID_TYPE:"Invalid type: {type} (expected {expected})",ENUM_MISMATCH:"No enum match for: {value}",ANY_OF_MISSING:'Data does not match any schemas from "anyOf"',ONE_OF_MISSING:'Data does not match any schemas from "oneOf"',ONE_OF_MULTIPLE:'Data is valid against more than one schema from "oneOf": indices {index1} and {index2}',NOT_PASSED:'Data matches schema from "not"',NUMBER_MULTIPLE_OF:"Value {value} is not a multiple of {multipleOf}",NUMBER_MINIMUM:"Value {value} is less than minimum {minimum}",NUMBER_MINIMUM_EXCLUSIVE:"Value {value} is equal to exclusive minimum {minimum}",NUMBER_MAXIMUM:"Value {value} is greater than maximum {maximum}",NUMBER_MAXIMUM_EXCLUSIVE:"Value {value} is equal to exclusive maximum {maximum}",NUMBER_NOT_A_NUMBER:"Value {value} is not a valid number",STRING_LENGTH_SHORT:"String is too short ({length} chars), minimum {minimum}",STRING_LENGTH_LONG:"String is too long ({length} chars), maximum {maximum}",STRING_PATTERN:"String does not match pattern: {pattern}",OBJECT_PROPERTIES_MINIMUM:"Too few properties defined ({propertyCount}), minimum {minimum}",OBJECT_PROPERTIES_MAXIMUM:"Too many properties defined ({propertyCount}), maximum {maximum}",OBJECT_REQUIRED:"Missing required property: {key}",OBJECT_ADDITIONAL_PROPERTIES:"Additional properties not allowed",OBJECT_DEPENDENCY_KEY:"Dependency failed - key must exist: {missing} (due to key: {key})",ARRAY_LENGTH_SHORT:"Array is too short ({length}), minimum {minimum}",ARRAY_LENGTH_LONG:"Array is too long ({length}), maximum {maximum}",ARRAY_UNIQUE:"Array items are not unique (indices {match1} and {match2})",ARRAY_ADDITIONAL_ITEMS:"Additional items not allowed",FORMAT_CUSTOM:"Format validation failed ({message})",KEYWORD_CUSTOM:"Keyword failed: {key} ({message})",CIRCULAR_REFERENCE:"Circular $refs: {urls}",UNKNOWN_PROPERTY:"Unknown property (not in schema)"};g.prototype=Object.create(Error.prototype),g.prototype.constructor=g,g.prototype.name="ValidationError",g.prototype.prefixWith=function(e,t){e!==null&&(e=e.replace(/~/g,"~0").replace(/\//g,"~1"),this.dataPath="/"+e+this.dataPath),t!==null&&(t=t.replace(/~/g,"~0").replace(/\//g,"~1"),this.schemaPath="/"+t+this.schemaPath);if(this.subErrors!==null)for(var n=0;n<this.subErrors.length;n++)this.subErrors[n].prefixWith(e,t);return this};var b={},E=w();return E.addLanguage("en-gb",m),E.tv4=E,E}),define("JSComposer/Schema",["JSComposer/Utils","tv4"],function(e,t){function i(t,r){return r=e.ldef(r,n.id),r=r.replace(/#/,t),r}function s(e,n){n=i(e,n);if(t.getSchema(n)===undefined)throw"invalid_uri";return{$ref:n}}function o(e,n){r[e]=n,t.addSchema(e,n)}function u(e){e.match(/#$/)===null&&(e+="#");if(t.getSchema(e)!==undefined)return;var n=new XMLHttpRequest;n.open("GET",e,!1),n.send(null);var r=JSON.parse(n.responseText);r.id!==undefined&&o(r.id,r),o(e,r)}function a(e){var n=e.match(/^[^#]*#/);if(n==null)throw{error:"bad_schema_uri",uri:e};return u(n[0]),t.getSchema(e)}typeof window.JSComposer=="undefined"&&(window.JSComposer={});var n={$schema:"http://json-schema.org/draft-04/schema#",id:"http://jscomposer.net/schema/jscomposer#",definitions:{label:{type:"string"}}},r=[];return o(n),{Fetch:a,Load:u,LoadRaw:o,Ref:s,URI:i}}),define("JSComposer/Instance",["JSComposer/Utils","JSComposer/Schema"],function(e,t){function n(t,n,r,i){this.context=t,this.parent=n,this.elements={ctr:e.makeElement("div",{className:"panel panel-default"})},schema=e.ldef(r,{type:"null"});for(var s in schema){if(!schema.hasOwnProperty(s))continue;this[s]=schema[s]}}return n.Objects={},n.Schema={},n.ResolveSchema=function(r,i,s){function o(t,n,r){r=e.ldef(r,!1);if(i.constructors.hasOwnProperty(t))return;i.constructors[t]=n,r?i.cons_order.unshift(t):i.cons_order.push(t)}typeof i=="undefined"&&(i={},Object.defineProperty(i,"constructors",{configurable:!0,enumerable:!1,value:{}}),Object.defineProperty(i,"cons_order",{configurable:!0,enumerable:!1,value:[]}));if(typeof r.constructors!="undefined")for(var u in r.constructors){if(!r.constructors.hasOwnProperty)continue;o(u,r.constructors[u])}s=e.ldef(s,!0);for(var a in r)switch(a){case"$ref":var f=r[a],l=t.Fetch(f),c=n.Objects[f];console.log("Dereferenced URI:",f,"::",l,"::",c),c!==undefined&&o(f,c),n.ResolveSchema(l,i);break;case"enum":o("enum",n.Objects["enum"]),i[a]=e.clone(r[a]);break;case"oneOf":typeof i.oneOf=="undefined"&&(i.oneOf=[]);if(r[a].length===1){var h=n.ResolveSchema(r[a][0]);i.oneOf.push(h),n.ResolveSchema(r[a][0],i)}else{for(var p=0,d=r[a].length;p<d;++p)i.oneOf.push(n.ResolveSchema(r[a][p]));var c=n.Objects.oneOf;o("oneOf",c,!0)}break;case"allOf":case"anyOf":typeof i[a]=="undefined"&&(i[a]=[]);var s=a==="allOf"?!1:!0;for(var p=0,d=r[a].length;p<d;++p){var h=n.ResolveSchema(r[a][p],undefined,s);i[a].push(h),n.ResolveSchema(h,i)}break;case"additionalProperties":i[a]=r[a];break;case"properties":case"patternProperties":typeof i[a]=="undefined"&&(i[a]={});for(var u in r[a])i[a][u]=e.clone(r[a][u]);break;case"type":switch(typeof i[a]){case"undefined":i[a]=typeof r[a]=="string"?r[a]:e.clone(r[a]);break;case"string":if(s)i[a]=[i[a]];else if(i[a]!==r[a])throw console.log("[Instance.ResolveSchema]","invaid type merger",i,"::",r),"invalid_type_merger";if(r[a]!==i[a])if(typeof r[a]=="string")i[a].indexOf(r[a])<0&&i[a].push(r[a]);else for(var p=0,d=r[a].length;p<d;++p)i[a].indexOf(r[a][p])<0&&i[a].push(r[a][p]);break;case"object":default:if(!s)throw console.log("[Instance.ResolveSchema]","invaid type merger (2)",i,"::",r),"invalid_type_merger";for(var p=0,d=r[a].length;p<d;++p)i[a].indexOf(r[a][p])<0&&i[a].push(r[a][p])}break;default:typeof i[a]=="undefined"&&(i[a]=r[a])}if(typeof i.oneOf!="undefined"){var v=typeof i.anyOf=="undefined"?[]:i.anyOf,m=typeof i.allOf=="undefined"?[]:i.allOf,g=v.concat(m);for(var p=0,d=i.oneOf.length;p<d;++p)for(var y=0,b=g.length;y<b;++y)console.log("PRE-TITLE:",i.oneOf[p].title,g[y].title),i.oneOf[p]=n.ResolveSchema(g[y],i.oneOf[p],!1),console.log("POST-TITLE:",i.oneOf[p].title,g[y].title)}typeof i.type=="object"&&i.type.length===1&&(i.type=i.type[0]);if(typeof i.type=="string")o(i.type,n.Objects[i.type]);else if(typeof i.type=="undefined"){var f=t.URI("#/definitions/label"),c=n.Objects[f];o(f,c)}else console.log("[Instance.ResolveSchema]","Multitype Field",i.type);return i},n.RegisterInstance=function(e,t){if(n.Objects[e]!==undefined)throw"Object already defined: "+e;n.Objects[e]=t},n.prototype.CreateInstance=function(e,t){return n.CreateInstance(this.context,this,e,t)},n.CreateInstance=function(e,r,i,s){var o=undefined;if(i===undefined||typeof i!="object")throw"invalid schema";i=n.ResolveSchema(i);if(i.cons_order.length>0){var u=i.cons_order[0],a=i.constructors[u];return new a(e,r,i,s)}return n.CreateInstance(e,r,t.Ref("#/definitions/label"),s)},n.prototype.Render=function(e){e.appendChild(this.elements.ctr)},n.prototype.GetValue=function(){return null},n.prototype.Destroy=function(){var e=this.elements.ctr.parentElement;e.removeChild(this.elements.ctr)},n.prototype.OnChange=function(){},n.RegisterInstance("null",n),n}),define("JSComposer/Form",["JSComposer/Utils","JSComposer/Instance","tv4"],function(e,t,n){function r(n,i){var s=this;this.schema=n,this.formNumber=++r.count,this.formID="js_composer_form_"+this.formNumber.toString(),this.elements={form:e.makeElement("form",{name:this.formID,id:this.formID,method:"POST",className:"panel"}),body:e.makeElement("div",{className:"panel-body"}),footer:e.makeElement("div",{className:"panel-footer"}),submit:e.makeElement("div",{className:"submit btn btn-default"})},e.setText(this.elements.submit,"Submit"),e.attachEvent(this.elements.submit,"click",function(e){return s.OnSubmit(e)}),this.field=t.CreateInstance(this,null,n,i),console.log(this.field)}return r.count=0,r.prototype.Render=function(e){this.field.Render(this.elements.body),this.elements.footer.appendChild(this.elements.submit),this.elements.form.appendChild(this.elements.body),this.elements.form.appendChild(this.elements.footer),e.appendChild(this.elements.form)},r.prototype.GetObject=function(){var e=this.field.GetValue();return console.log("Validating: ",n.validate(e,this.schema),"::",n.error),JSON.stringify(e)},r.prototype.OnSubmit=function(){var t=this.GetObject(),n=e.makeElement("input",{type:"hidden",name:"json",value:t});this.elements.form.appendChild(n),this.elements.form.submit()},r}),define("JSComposer/Entry",["JSComposer/Utils","JSComposer/Instance"],function(e,t){function n(n,r,i,s,o,u){var a=this;this.context=n,this.parent=r,this.elements={key:e.makeElement("label",{className:"control-label"}),value:e.makeElement("div",{})},this.schema={key:i,value:s},this.fields={key:t.CreateInstance(n,r,i,o),value:t.CreateInstance(n,r,s,u)},this.fields.key.OnChange=e.appendFunction(this.fields.key.OnChange,function(){a.OnKeyChange()}),this.fields.value.OnChange=e.appendFunction(this.fields.value.OnChange,function(){a.OnValueChange()})}return n.prototype.GetKey=function(){return this.fields.key.GetValue()},n.prototype.GetKeyInstance=function(){return this.fields.key},n.prototype.GetValue=function(){return this.fields.value.GetValue()},n.prototype.GetValueInstance=function(){return this.fields.value},n.prototype.SetValueSchema=function(e,n){if(e===this.schema.value)return;this.fields.value.Destroy();var r=t.CreateInstance(this.context,this.parent,e,n);r.Render(this.elements.value),this.fields.value=r,this.schema.value=e},n.prototype.OnKeyChange=function(){},n.prototype.OnValueChange=function(){},n.prototype.Render=function(e){this.fields.key.Render(this.elements.key),this.fields.value.Render(this.elements.value),e.appendChild(this.elements.key),e.appendChild(this.elements.value)},n.prototype.Destroy=function(){this.fields.key.Destroy(),this.fields.value.Destroy(),this.elements.key.parentNode.removeChild(this.elements.key),this.elements.value.parentNode.removeChild(this.elements.value)},n}),define("JSComposer/Instance/ArrayInstance",["JSComposer/Utils","JSComposer/Schema","JSComposer/Instance"],function(e,t,n){function r(t,r,i,s){n.apply(this,arguments),s=s||[],this.fields=[],this.allow_null=e.ldef(this.allow_null,!1),this.items=e.ldef(this.items,{oneOf:[{type:"array"},{type:"boolean"},{type:"integer"},{type:"null"},{type:"number"},{type:"object"},{type:"string"}]}),this.minItems=e.ldef(this.minItems,0),this.title=e.ldef(this.title,"An Array"),this.elements.header=e.makeElement("div",{className:"array panel-heading"}),this.elements.footer=e.makeElement("div",{className:"array panel-footer text-right"}),this.elements.body=e.makeElement("div",{className:"array panel-body"}),this.elements.title=e.makeElement("h4",{className:"array panel-title"}),e.setText(this.elements.title,this.title),e.applyClass(this.elements.ctr,"array"),this.elements.header.appendChild(this.elements.title),this.elements.ctr.appendChild(this.elements.header),this.elements.ctr.appendChild(this.elements.body),this.elements.ctr.appendChild(this.elements.footer);var o=this;more=e.makeElement("div",{className:"create btn btn-success"}),e.setText(more,"Add"),e.attachEvent(more,"click",function(){console.log("Adding entry"),o.AddEntry()}),this.elements.footer.appendChild(more);for(var u=0;u<s.length;++u)this.AddEntry(s[u])}return r.prototype=new n,r.prototype.constructor=r,r.prototype.AddEntry=function(t){var n=e.makeElement("div",{className:"array entry panel panel-default panel-body"}),r=e.makeElement("div",{style:{overflow:"hidden",paddingRight:"15px"}}),i=this.CreateInstance(this.items,t),s=e.makeElement("button",{type:"button",className:"delete btn btn-danger pull-right"});e.setText(s,"Delete"),this.fields.push(i),n.appendChild(s),n.appendChild(r),i.Render(r),this.elements.body.appendChild(n)},r.prototype.GetValue=function(){var e=[],t=this.fields.length;if(this.allow_null&&t==0)return null;for(var n=0;n<t;++n)e.push(this.fields[n].GetValue());return e},n.RegisterInstance("array",r),r}),define("JSComposer/Instance/SelectInstance",["JSComposer/Utils","JSComposer/Instance"],function(e,t){function n(n,r,i,s){t.apply(this,arguments);var o=this;if(typeof this["enum"]=="object"&&typeof this["enum"].length!="undefined"){var u={};for(var a=0,f=this["enum"].length;a<f;++a)u[this["enum"][a]]=this["enum"][a];this["enum"]=u}else typeof this["enum"]=="undefined"&&(this["enum"]={});this.allow_null=this["enum"].hasOwnProperty("null"),this.elements.select=e.makeSelect(this["enum"],this.allow_null),e.applyClass(this.elements.select,"form-control"),e.attachEvent(this.elements.select,"change",function(){o.OnChange()}),e.setSelectValue(this.elements.select,s),this.currValue=e.getSelectValue(this.elements.select),this.prevValue=undefined}return n.prototype=new t,n.prototype.constructor=n,n.prototype.GetValue=function(){return e.getSelectValue(this.elements.select)},n.prototype.Render=function(e){this.elements.ctr=this.elements.select,e.appendChild(this.elements.ctr)},n.prototype.SetOptions=function(t){e.setSelectOptions(this.elements.select,this.allow_null,t)},n.prototype.OnChange=function(){this.prevValue=this.currValue,this.currValue=e.getSelectValue(this.elements.select)},t.RegisterInstance("enum",n),n}),define("JSComposer/Instance/BooleanInstance",["JSComposer/Instance","JSComposer/Instance/SelectInstance"],function(e,t){function n(e,n,r,i){r.enum={"true":"True","false":"False"},i=i===!0?"true":"false",t.call(this,e,n,r,i)}return n.prototype=new t,n.prototype.constructor=n,n.prototype.GetValue=function(){var e=t.prototype.GetValue.call(this);return e==="true"?!0:!1},e.RegisterInstance("boolean",n),n}),define("JSComposer/Instance/NumberInstance",["JSComposer/Utils","JSComposer/Instance"],function(e,t){function n(n,r,i,s){t.apply(this,arguments),this.elements.input=e.makeElement("input",{className:"form-control"});var o=this;s=e.ldef(s,0),this.key_regex=new RegExp("[^0-9.-]"),this.minimum_distance=this.exclusiveMinimum===!0?1e-6:0,this.maximum_distance=this.exclusiveMaximum===!0?1e-6:0,e.attachEvent(this.elements.input,"keypress",function(){return o.OnKeyDown.apply(o,arguments)}),e.attachEvent(this.elements.input,"change",function(){return o.OnChange.apply(o,arguments)}),this.SetValue(s)}function r(e,t){var n=String.fromCharCode(e.keyCode),r=!0;return n.match(t)&&(console.log("MATCH"),e.cancelBubble=!0,e.preventDefault&&e.preventDefault(),r=!1),r}return n.prototype=new t,n.prototype.constructor=n,n.prototype.Render=function(e){this.elements.ctr=this.elements.input,e.appendChild(this.elements.ctr)},n.prototype.GetValue=function(){return parseFloat(this.elements.input.value)},n.prototype.OnKeyDown=function(e){return console.log("Keypress detected:",this,"::",this.key_regex,"::",e),r(e,this.key_regex)},n.prototype.OnChange=function(){this.SetValue(this.elements.input.value)},n.prototype.SetValue=function(e){console.log("Forming Value: ",e),typeof this.minimum!==undefined&&e<this.minimum+this.minimum_distance&&(e=this.minimum+this.minimum_distance),typeof this.maximum!==undefined&&e>this.maximum-this.minimum_distance&&(e=this.maximum-this.maximum_distance),console.log("Value Formed: ",e),this.elements.input.value=e},t.RegisterInstance("number",n),n}),define("JSComposer/Instance/IntegerInstance",["JSComposer/Utils","JSComposer/Instance","JSComposer/Instance/NumberInstance"],function(e,t,n){function r(t,r,i,s){s=e.ldef(s,i.default,0),n.apply(this,arguments),this.key_regex=new RegExp("[^0-9-]"),this.minimum_distance=this.exclusiveMinum===!0?1:0,this.maximum_distance=this.exclusiveMaxum===!0?1:0,this.elements.input.value=s,this.SetValue(s)}return r.prototype=new n,r.prototype.constructor=r,r.prototype.GetValue=function(){return parseInt(this.elements.input.value)},t.RegisterInstance("integer",r),r}),define("JSComposer/Instance/ObjectInstance",["JSComposer/Utils","JSComposer/Schema","JSComposer/Instance","JSComposer/Entry"],function(t,n,r,i){function s(n,i,s,o){r.apply(this,arguments),this.properties=t.ldef(this.properties,{}),this.additionalProperties=t.ldef(this.additionalProperties,!0),this.patternProperties=t.ldef(this.patternProperties,{}),this.required=t.ldef(this.required,[]),this.supported=t.getKeys(this.properties),this.patterns=t.map(function(e){return new RegExp(e)},t.getKeys(this.patternProperties)),this.property_map={required:[],optional:[],pattern:[],additional:[]},this.property_pam={},this.entries={required:[],optional:[],pattern:[],additional:[],by_key:{}},this.elements.sections={},this.section_count=0,this.title=t.ldef(this.title,"An Object"),o=t.ldef(o,{}),this.property_map.required=this.required;for(var u=0;u<this.property_map.required.length;++u)this.property_pam[this.property_map.required[u]]="required";for(var a in this.properties){if(this.property_pam.hasOwnProperty(a))continue;this.property_map.optional.push(a),this.property_pam[a]="optional"}for(var a in o){if(this.property_pam.hasOwnProperty(a))continue;t.any(function(t){return e.exec(a)!==null},this.patterns)?(this.property_map.pattern.push(a),this.property_pam[a]="pattern"):(this.property_map.additional.push(a),this.property_pam[a]="additional")}this.elements.body=t.makeElement("div",{className:"panel-body"}),this.elements.header=t.makeElement("div",{className:"panel-heading"}),this.elements.title=t.makeElement("h3",{className:"panel-title"}),t.setText(this.elements.title,this.title),t.applyClass(this.elements.ctr,"object"),this.elements.header.appendChild(this.elements.title),this.elements.ctr.appendChild(this.elements.header),this.elements.ctr.appendChild(this.elements.body),o=t.ldef(o,{}),this.property_map.required.length>0&&(console.log("Adding section for required properties: ",this.property_map.required),this.AddSection("required",this.property_map.required,o)),this.property_map.optional.length>0&&this.AddSection("optional",this.property_map.optional,o),this.patterns.length>0&&this.AddSection("pattern",this.property_map.pattern,o),console.log("Additional properties, eh? ",this.additionalProperties),this.additionalProperties!==!1&&this.AddSection("additional",this.property_map.additional,o),this.CompilePatterns()}return s.prototype=new r,s.prototype.constructor=s,s.Default={},s.Descriptor={type:"object_type",properties:{label:{type:"text",label:"Label"},header:{type:"boolean",label:"Display Header"},properties:{type:"object",additionalProperties:{},label:"Properties"},order:{type:"order",options:[],label:"Instance Order"}}},s.PropertyOptions={required:{deletable:!1,more:!1,header:"Required Properties"},optional:{deletable:!0,more:!0,header:"Optional Properties"},pattern:{deletable:!0,more:!0,header:"Patterned Properties"},additional:{deletable:!0,more:!0,header:"Extra Properties"}},s.prototype.GetKeySchema=function(e){switch(e){case"required":return n.Ref("#/definitions/label");case"optional":return{"enum":this.property_map.optional};case"pattern":default:return{type:"string"}}},s.prototype.AddSection=function(e,n,r){var i=s.PropertyOptions[e];++this.section_count;if(e=="required"){console.log("We're the first!");var o=this.elements.ctr,u=this.elements.header,a=this.elements.title,f=this.elements.body,l=undefined,c=undefined;i.more&&(l=t.makeElement("div",{className:"object-section panel-footer text-right"}),o.appendChild(l)),t.applyClass(a,"float-pair"),u.style.overflow="auto"}else{var o=t.makeElement("div",{className:"object-section panel panel-default"}),u=t.makeElement("div",{className:"object-section panel-heading"}),a=t.makeElement("h4",{className:"object-section panel-title"}),f=t.makeElement("div",{className:"object-section panel-body"}),l=t.makeElement("div",{className:"object-section panel-footer text-right"}),c=undefined;t.applyClass(f,e),t.applyClass(u,e),t.setText(a,i.header),u.appendChild(a),o.appendChild(u),o.appendChild(f),o.appendChild(l),this.elements.body.appendChild(o)}if(i.more){var h=this;c=t.makeElement("button",{type:"button",className:"create btn btn-success"}),t.setText(c,"Add"),t.attachEvent(c,"click",function(){h.OnAddEntry(e)}),l.appendChild(c)}this.elements.sections[e]=f;for(var p=0;p<n.length;++p){var d=n[p];console.log("Adding entry for ",n[d],"; value: ",r[d]);if(e!=="required"&&!r.hasOwnProperty(d))continue;var v=this.GetKeySchema(e);v.title=typeof this.properties[d].title!="undefined"?this.properties[d].title:v.title,this.AddEntry(e,v,this.properties[d],d,r[d],s.PropertyOptions[e])}},s.prototype.AddEntry=function(e,n,r,o,u){var a=this,f=new i(this.context,this,n,r,o,u),l=f.GetValueInstance(),c=f.GetKeyInstance(),h=t.makeElement("div",{className:"panel panel-default"}),p=t.makeElement("div",{className:"panel-body"}),d=t.makeElement("div",{className:""}),v=t.makeElement("div",{className:"btn-group pull-right"}),m=null,g=s.PropertyOptions[e];l.OnChange=t.appendFunction(l.OnChange,function(){a.OnChange(e,"value",f)}),c.OnChange=t.appendFunction(c.OnChange,function(){a.OnChange(e,"key",f)}),e==="optional"&&this.useOptionalKey(o),g.deletable&&(m=t.makeElement("button",{type:"button",className:"delete btn btn-danger"}),t.setText(m,"Delete"),t.attachEvent(m,"click",function(){console.log("Destroying entry"),f.Destroy(),console.log("Removing container"),h.parentElement.removeChild(h),console.log("Removing references to entry");var t=a.entries[e].indexOf(f);t!==-1&&a.entries[e].splice(t,1)}),v.appendChild(m)),this.entries[e].push(f),f.Render(d),h.appendChild(p),p.appendChild(v),p.appendChild(d);var y=this.elements.sections[e];y.appendChild(h)},s.prototype.OnAddEntry=function(e){var t=this[e],n=s.PropertyOptions[e],r=this.GetKeySchema(e),i=undefined,o=undefined;if(e==="additional")typeof this.additionalProperties=="boolean"?(o={oneOf:[{type:"string"},{type:"number"},{type:"object"}]},i=""):o=this.additionalProperties;else if(e==="pattern"){var u=!1,a=undefined;do{i=prompt("Enter a new property name.");if(i===null){i=undefined;break}a=this.patternScan(i),a&&(o=this.patternProperties[a],u=!0)}while(u=!1)}else e==="optional"&&(i=this.property_map.optional[0],o=this.properties[i]);typeof r!="undefined"&&typeof o!="undefined"&&this.AddEntry(e,r,o,i,undefined,n)},s.prototype.patternScan=function(e){if(typeof this.patternProperties=="undefined")return undefined;for(var t in this.patternProperties)if(e.match(this.compiledPatterns[k]))return t;return!1},s.prototype.useOptionalKey=function(e){return;var t},s.prototype.freeAdditionalKey=function(e){var t=this.additionalUsed.indexOf(e);if(t<0)throw"freeing_unused_key";this.additionalUsed.splice(t,1),this.additionalAvailable.push(e),this.updateAdditionalOptions()},s.prototype.updateOptionalKeys=function(){function i(){var e={};for(var n=0,i=t.length;n<i;++n){var s=t[n],o=r.additionalTitles[s];e[s]=o}return e}var e=this.entries.optional,t=this.additionalAvailable,n=undefined,r=this;for(var s=0,o=e.length;s<o;++s){var u=e[s],a=u.GetKeyInstance(),f=a.GetValue(),l=this.additionalTitles[f],c=i();c[f]=l,a.SetOptions(c)}},s.prototype.CompilePatterns=function(){if(typeof this.patternProperties=="undefined")return undefined;this.compiledPatterns={};for(var e in this.patternProperties){var t=new RegExp(e);this.compiledPatterns[e]=t}},s.prototype.GetValue=function(){var e={};for(var t in this.entries){if(!this.entries.hasOwnProperty(t))continue;var n=this.entries[t];for(var r=0,i=n.length;r<i;++r){var s=n[r].GetKey(),o=n[r].GetValue();e[s]=o}}return e},s.prototype.Render=function(e){e.appendChild(this.elements.ctr)},s.prototype.FindEntry=function(e){for(var t in this.entries){if(!this.entries.hasOwnProperty(t))continue;var n=this.entries[t],r=n.length,i=0;for(i=0;i<r;++i)if(n[i].GetKey()===e)return n[i]}return undefined},s.prototype.OnChange=function(e,t,n){if(e==="optional"&&t==="key"){var r=n.GetKeyInstance().prevValue,i=n.GetKeyInstance().currValue;n.SetValueSchema(this.properties[i])}},s.prototype.GetKeys=function(){var e=[],t=0;l=this.entries.length;for(;t<l;++t)e.push(this.entries[t].GetKey());return e},r.RegisterInstance("object",s),s}),define("JSComposer/Instance/OfInstance",["JSComposer/Utils","JSComposer/Instance","JSComposer/Entry"],function(e,t,n){function r(r,i,s,o){t.apply(this,arguments),this.options=this.GetOptions();var u=this,a=undefined,f=undefined;if(typeof o!="undefined")for(var l=0,c=this.oneOf.length;l<c;++l)if(tv4.validate(o,this.oneOf[l])){a=this.oneOf[l],f=l;break}typeof a=="undefined"&&(a=this.oneOf[0],f=0),e.applyClass(this.elements.ctr,"entry"),e.removeClass(this.elements.ctr,"panel"),e.removeClass(this.elements.ctr,"panel-default"),this.entry=new n(this.context,this,{"enum":this.options},a,f.toString(),o),this.entry.OnKeyChange=e.appendFunction(this.entry.OnKeyChange,function(){u.OnKeyChange()})}return typeof window.JSComposer=="undefined"&&(window.JSComposer={}),r.prototype=new t,r.prototype.constructor=r,Object.defineProperty(r.prototype,"super",t),r.prototype.Render=function(e){this.entry.Render(this.elements.ctr),t.prototype.Render.call(this,e)},r.prototype.OnKeyChange=function(){var e=this.entry.GetKey(),t=this.oneOf[e];this.entry.SetValueSchema(t,this.entry.GetValue())},r.prototype.GetOptions=function(){var t={},n=this.oneOf.length,r=0;for(;r<n;++r){var i=this.oneOf[r];console.log("Got Schema: ",this.oneOf[r]),t[r]=e.ldef(i.title,i.id,i.type,r)}return console.log("Got Options: ",t),t},r.prototype.GetValue=function(){return this.entry.GetValue()},t.RegisterInstance("oneOf",r),r}),define("JSComposer/Instance/OrderInstance",["JSComposer/Utils","JSComposer/Instance","JSComposer/Instance/SelectInstance"],function(e,t,n){function r(t,r){t.allow_null=!1,console.log("ALLOW_NULL IS FALSE"),n.call(this,t,r);var i=this;this.elements.select.multiple=!0,this.elements.up_button=e.makeElement("div",{className:"order button up"}),e.attachEvent(this.elements.up_button,"click",function(){i.OnUpClick()}),this.elements.down_button=e.makeElement("div",{className:"order button down"}),e.attachEvent(this.elements.down_button,"click",function(){i.OnDownClick()}),e.applyClass(this.elements.ctr,"big"),e.applyClass(this.elements.select,"multi"),e.applyClass(this.elements.select,"order"),this.selected=this.elements.select.selectedIndex}return r.prototype=new n,r.prototype.constructor=r,r.prototype.Render=function(e){n.prototype.Render.call(this,e),this.elements.ctr.appendChild(this.elements.up_button),this.elements.ctr.appendChild(this.elements.down_button)},r.prototype.OnSelect=function(){var e=this.elements.select.selectedIndex;this.selected===-1?this.selected=e:this.elements.select.options[this.selected].selected=!1,this.selected=this.elements.select.selectedIndex},r.prototype.OnUpClick=function(){var e=this.elements.select,t=e.options.item(e.selectedIndex),n=e.options.item(e.selectedIndex-1);if(n===null)return undefined;e.removeChild(t),e.insertBefore(t,n),t.selected=!0,this.selected=e.selectedIndex,console.log("SELECTED: ",e.options)},r.prototype.OnDownClick=function(){if(this.selected<0)return undefined;var e=this.elements.select,t=e.options.item(e.selectedIndex),n=e.options.item(e.selectedIndex+1);if(n===null)return undefined;e.removeChild(n),e.insertBefore(n,t),t.selected=!0,this.selected=e.selectedIndex,console.log("SELECTED: ",e.options)},r.prototype.GetValue=function(){var e=[],t=this.elements.select,n=0,r=t.options.length;for(;n<r;++n)e.push(t.options[n].value);return e},t.RegisterInstance("order",r),r}),define("JSComposer/Instance/StringInstance",["JSComposer/Utils","JSComposer/Instance"],function(e,t){function n(n,r,i,s){var o=this;i=e.ldef(i,{}),t.apply(this,arguments),this.is_big=e.ldef(i.big,!1),this.is_big?(this.elements.text=e.makeElement("textarea",{}),e.applyClass(this.elements.ctr,"big")):this.elements.text=e.makeElement("input",{type:"text",className:"form-control"}),this.elements.text.value=e.ldef(s,""),e.attachEvent(this.elements.text,"change",function(){o.OnChange()})}return n.prototype=new t,n.prototype.constructor=n,n.prototype.Render=function(e){this.elements.ctr=this.elements.text,e.appendChild(this.elements.ctr)},n.prototype.GetValue=function(){return this.elements.text.value},t.RegisterInstance("string",n),n}),define("JSComposer/Instance/PasswordInstance",["JSComposer/Instance","JSComposer/Instance/StringInstance"],function(e,t){function n(e,n){t.apply(this,arguments),this.elements.text.type="password",this.elements.text.value=""}return n.prototype=new t,n.prototype.constructor=n,e.RegisterInstance("password",n),n}),define("JSComposer/Instance/StaticInstance",["JSComposer/Utils","JSComposer/Schema","JSComposer/Instance"],function(e,t,n){function r(t,r,i,s){n.apply(this,arguments);var o=e.ldef(this.title,s,"");e.setText(this.elements.ctr,o),this.value=s}return r.prototype=new n,r.prototype.constructor=r,r.prototype.GetValue=function(){return this.value},n.RegisterInstance(t.URI("#/definitions/label"),r),r}),define("JSComposer/Instance/TypeDescInstance",["JSComposer/Utils","JSComposer/Instance"],function(e,t){function n(r,i){i=e.ldef(i,{type:"null"}),t.apply(this,arguments),n.Initialize();var s=this;this.elements.key=e.makeElement("div",{className:"key field"}),this.elements.value=e.makeElement("div",{className:"value field"}),this.elements.key_node=e.makeElement("div",{className:"node"}),this.elements.select=e.makeSelect(n.Keys,!1),e.applyClass(this.elements.ctr,"entry"),this.elements.ctr.appendChild(this.elements.key),this.elements.key_node.appendChild(this.elements.select),this.elements.key.appendChild(this.elements.key_node),this.elements.ctr.appendChild(this.elements.value),e.setSelectValue(this.elements.select,i.type),e.attachEvent(this.elements.select,"change",function(){s.OnTypeChange.apply(s,[])}),this.OnTypeChange(i)}return n.Initialize=function(){if(n.Initialized)return undefined;n.Initialized=!0;var r=t.ObjectKeys.length;for(var i=0;i<r;++i){var s=t.ObjectKeys[i],o=t.Objects[s],u=e.ldef(o.Descriptor,{type:"object",fields:{},order:[]});n.Keys.push(s),n.Options[s]=u}},n.Initialized=!1,n.Options={},n.Keys=[],n.prototype=new t,n.prototype.constructor=n,n.prototype.GetValue=function(){var t=e.getSelectValue(this.elements.select),n=this.value.GetValue();return n.type=t,n},n.prototype.OnTypeChange=function(r){var i=e.getSelectValue(this.elements.select),s=n.Options[i];console.log("TypeDescInstance.OnTypeChange :: Setting Type: ",i,s);if(this.currType===i)return undefined;this.value!==undefined&&this.value.Destroy(),this.currType=i,this.value=t.CreateInstance(s,r),this.value.Render(this.elements.value)},t.RegisterInstance("schema",n),n}),define("JSComposer",["JSComposer/Utils","JSComposer/Schema","JSComposer/Form","JSComposer/Instance","JSComposer/Entry","JSComposer/Instance/ArrayInstance","JSComposer/Instance/BooleanInstance","JSComposer/Instance/IntegerInstance","JSComposer/Instance/NumberInstance","JSComposer/Instance/ObjectInstance","JSComposer/Instance/OfInstance","JSComposer/Instance/OrderInstance","JSComposer/Instance/PasswordInstance","JSComposer/Instance/SelectInstance","JSComposer/Instance/StaticInstance","JSComposer/Instance/StringInstance","JSComposer/Instance/TypeDescInstance"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){function g(e){m.Renderer=e}var m={Utils:e,Schema:t,Form:n,Instance:r,Entry:i,ArrayInstance:s,BooleanInstance:o,NumberInstance:u,ObjectInstance:a,OfInstance:f,OrderInstance:l,PasswordInstance:c,SelectInstance:h,StaticInstance:p,StringInstance:d,TypeDescInstance:v};return m.SetRenderer=g,m});